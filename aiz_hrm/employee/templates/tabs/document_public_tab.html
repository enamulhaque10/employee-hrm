{% load i18n %} {% load static %}

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title class="time-runner stop-runner">{{white_label_company_name}}</title>
    <link rel="stylesheet" href="{% static 'build/css/driver.min.css' %}" />
    <meta name="theme-color" content="orangered">
    <link rel="manifest" href="{% static 'build/manifest.json' %}">
    <!-- <link rel="apple-touch-icon" sizes="180x180"
        href="{% if white_label_company.icon %}{{white_label_company.icon.url}} {% else %}{% static 'favicons/apple-touch-icon.png' %}{% endif %}">
    <link rel="icon" type="image/png" sizes="32x32"
        href="{% if white_label_company.icon %}{{white_label_company.icon.url}} {% else %}{% static 'favicons/favicon2-32x32.png' %}{% endif %}">
    <link rel="icon" type="image/png" sizes="16x16"
        href="{% if white_label_company.icon %}{{white_label_company.icon.url}} {% else %}{% static 'favicons/favicon2-16x16.png' %}{% endif %}"> -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.20/dist/sweetalert2.min.css">

    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="{% static 'build/css/style.min.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'build/css/summernote-lite.min.css'%}"/>
    <link rel="stylesheet" href="{% static 'build/css/orgChart.css' %}" />
    <script src="{% static '/jquery/ajax.js' %}"></script>
    <script src="{% static '/jquery/jquery.min.js' %}"></script>
    <link rel="stylesheet" href="{% static '/jquery/jqueryui.css' %}">
    <script src="{% static '/jquery/jqueryui.js' %}"></script>
    <script src="{% static '/base/toggleColumn.js' %}"></script>
    <script src="{% static '/build/js/orgChart.js' %}"></script>
    <script src="{% static 'build/js/driver.js' %}"></script>
    <script src="{% static 'build/js/clearFilter.js' %}"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>



    <!-- Popper.JS -->
    <!-- Bootstrap JS -->
    {% block styles %}
    {% endblock styles %}
</head>
<div
  class="oh-general__tab-target oh-profile-section mb-4"
>
  <div class="oh-btn-group p-3 justify-content-end">
    <div>
      <button
        class="oh-btn oh-btn--secondary"
        data-toggle="oh-modal-toggle"
        data-target="#objectCreateModal"
        hx-get="{% url 'document-create-public'  emp_id %}"
        hx-target="#objectCreateModalTarget"
        onclick="event.preventDefault()"
      >
        <ion-icon name="add-sharp" class="mr-2"></ion-icon>{% trans "Create" %}
      </button>
    </div>
  </div>

  {% if documents %}
  <div class="mt-2">
    {% for document in documents %}
    <div id="document{{document.id}}">
      <div
        class="oh-user_permission-list_item accordion exclude-accordion-style"
        hx-get='{% url "view-file" document.id %}'
        hx-target="#viewFile"
        data-toggle="oh-modal-toggle"
        data-target="#viewFileModal"
      >
        <div class="oh-user_permission-list_profile">
          <div class="oh-navbar__user-photo oh-user_permission--profile">
            <span
              class="oh-badge oh-badge--secondary oh-badge--small oh-badge--round ms-2 mr-2 file-upload"
              hx-get="{% url 'file-upload' document.id %}"
              hx-target="#objectCreateModalTarget"
              data-document-id="{{ document.id }}"
              data-toggle="oh-modal-toggle"
              data-target="#objectCreateModal"
              onclick="event.stopPropagation()"
              title="Upload File"
            >
              <ion-icon
                class="md hydrated"
                name="add-outline"
                role="img"
                aria-label="add outline"
              ></ion-icon>
            </span>
          </div>
          <div class="oh-feedback-card__name-container ms-1 title_form">
            <form
              hx-post="{% url 'update-document-title' document.id %}"
              hx-swap="none"
              hx-on-htmx-after-request="setTimeout(() => { reloadMessage(); }, 300);"
            >
              <input
                class="oh-card__title oh-card__title--sm fw-bold me-1 editable-input"
                onclick="event.stopPropagation();"
                name="title"
                value="{{document.title}}"
                readonly
              />
              <span
                class="error oh-user_permission_list-text text-danger d-none"
                >{% trans "Title needs to be more than 3 letters" %}</span
              >
              <input
                class="d-none title-submit"
                type="submit"
                onclick="event.stopPropagation();"
              />
            </form>
            <span
              class="oh-text--light"
              title="{{document.document_request_id.description}}"
            >
              {{document.document_request_id.description|truncatechars:60}}
            </span>
            {% if document.issue_date %}
            <span
              class="oh-text--light"
              title="{{document.document_request_id.description}}"
            >
              {% trans "Issue Date" %} : {{ document.issue_date }}
            </span>
            
          </div>
        </div>
        <div class="oh-btn-group">
          {% if not document.document_request_id or
          perms.aiz_document.change_documentrequest %}
          <form
            hx-confirm="{% trans 'Are you sure you want to delete this Document Request?' %}"
            hx-post="{% url 'document-delete' document.id %}"
            hx-target="#document{{document.id}}"
            hx-swap="outerHTML"
            hx-on-htmx-after-request="setTimeout(() => { reloadMessage(); }, 300);"
            onclick="event.stopPropagation()"
          >
            {% csrf_token %}
            <button
              type="submit"
              class="oh-btn oh-btn--secondary"
              title="{% trans 'Delete' %}"
            >
              <ion-icon
                class="me-1 md hydrated"
                name="trash-outline"
                role="img"
                aria-label="trash outline"
              ></ion-icon>
            </button>
          </form>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div
    class="d-flex justify-content-center align-items-center"
    style="height: 40vh"
  >
    <div class="text-center">
      <img
        class="oh-404__image mb-3"
        style="width: 150px; height: 150px"
        src="{% static 'images/ui/no_documents.png' %}"
        alt="No documents"
      />
      <h5 class="oh-404__subtitle">
        {% trans "No documents have been uploaded yet." %}
      </h5>
    </div>
  </div>
  {% endif %}

  <div
    class="oh-modal"
    id="viewFileModal"
    role="dialog"
    aria-labelledby="viewFileModal"
    aria-hidden="true"
  >
    <div class="oh-modal__dialog custom-dialog">
      <div class="oh-modal__dialog-header">
        <span class="oh-modal__dialog-title" id="viewFileModalLabel"
          >{% trans "View File" %}</span
        >
        <button class="oh-modal__close" aria-label="Close">
          <ion-icon
            name="close-outline"
            role="img"
            class="md hydrated"
            aria-label="close outline"
          ></ion-icon>
        </button>
      </div>
      <div class="oh-modal__dialog-body" id="viewFile"></div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function () {
    editableInput = $(".editable-input");
    var typingTimer;
    var doneTypingInterval = 300;

    editableInput.on("focus", function () {
      $(this).prop("readonly", false);
    });

    editableInput.on("blur", function () {
      $(this).prop("readonly", true);
    });

    editableInput.on("keyup", function () {
      let error = "";
      let $this = $(this);
      clearTimeout(typingTimer);
      typingTimer = setTimeout(function () {
        if ($this.val().length <= 3) {
          $this.siblings(".error").removeClass("d-none");
          $this.siblings(".error").addClass("d-block");
        } else {
          $this.siblings(".title-submit").click();
          $this.siblings(".error").removeClass("d-block");
          $this.siblings(".error").addClass("d-none");
        }
      }, doneTypingInterval);

      if (event.keyCode === 13) {
        $(this).blur();
      }
    });
  });
</script>
